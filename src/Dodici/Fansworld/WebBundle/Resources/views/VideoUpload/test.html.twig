<html>
    <head>
        <link rel="stylesheet" type="text/css" href="{{ asset('bundles/dodicifansworldweb/js/file-uploader/fileuploader.css') }}">
        <script src="{{ asset('bundles/dodicifansworldweb/js/jquery/jquery-1.7.2.min.js') }}" type="text/javascript"></script>
        <script src="{{ asset('bundles/dodicifansworldweb/js/file-uploader/fileuploader.js') }}" type="text/javascript"></script>
    </head>
    <body>
        <div>1. upload file</div>
        <div id="file-uploader">
            <noscript>
                <p>Please enable JavaScript to use file uploader.</p>
            </noscript>
        </div>
        
        <div>2. add entry</div>
        <div id="upload-process">
            <input type="text" name="uploadtoken" id="uploadtoken" />
            <input type="button" name="addentry" id="addentry" value="GO!" />
        </div>
        
        
        <script type="text/javascript">
        $(function(){
            // upload the file, get the upload token
            var uploader = new qq.FileUploader({
                element: $('#file-uploader')[0],
                multiple: false,
                forceMultipart: true,
                normalHeaders: false,
                responsePassthrough: true,
                debug: true,
                action: '{{url}}',
                inputName: 'fileData',
                failedUploadTextDisplay: {mode: 'none'},
                params: {
                    service: 'media',
                    action: 'upload',
                    ks: '{{ks}}',
                    partnerId: '{{partnerid}}'
                },
                onComplete: function(id, fileName, xml){
                    var xmlDoc = $.parseXML(xml);
                    var $xml = $( xmlDoc );
                    var result = $xml.find( "result" );
                    $('#uploadtoken').val(result.text());
                }
            }); 
            
            // add the entry
            $('#addentry').on('click', function(){
                $.ajax({
                    url: '{{url}}',
                    data: {
                        service: 'media',
                        action: 'addfromuploadedfile',
                        ks: '{{ks}}',
                        uploadTokenId: $('#uploadtoken').val(),
                        'mediaEntry:name': 'tetetest',
                        'mediaEntry:mediaType': 1
                    },
                    dataType: 'xml',
                    success: function(r) {
                        var external_id = $(r).find('id').text();
                        // set this as a Video's "external"
                        alert(external_id);
                    }
                });
            });
        });
        </script>
    </body>
</html>